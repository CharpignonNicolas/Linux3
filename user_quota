#!/bin/bash

# Script pour configurer les quotas pour un utilisateur spécifique

# Vérification que le script est exécuté en tant que root
if [[ $EUID -ne 0 ]]; then
    echo "Ce script doit être exécuté en tant que root."
    exit 1
fi

# Demander le nom de l'utilisateur
echo -n "Entrez le nom de l'utilisateur : "
read USERNAME

# Vérifier si l'utilisateur existe
if ! id "$USERNAME" &>/dev/null; then
    echo "L'utilisateur $USERNAME n'existe pas."
    exit 1
fi

# Demander les limites de quota
echo -n "Entrez la limite douce (soft limit) en blocs (1 bloc = 1 Ko ou selon la configuration) : "
read SOFT_LIMIT

echo -n "Entrez la limite dure (hard limit) en blocs : "
read HARD_LIMIT

# Répertoire où les quotas sont activés (exemple : /home)
QUOTA_DIR="/home"

# Vérification que les quotas sont activés sur le système
df -hT $QUOTA_DIR | grep -i "usrquota" &>/dev/null
if [[ $? -ne 0 ]]; then
    echo "Les quotas ne semblent pas activés sur $QUOTA_DIR. Activez-les avant d'exécuter ce script."
    exit 1
fi

# Appliquer les quotas pour l'utilisateur
setquota -u $USERNAME $SOFT_LIMIT $HARD_LIMIT 0 0 $QUOTA_DIR

# Vérification et affichage du quota configuré
if [[ $? -eq 0 ]]; then
    echo "Quota configuré avec succès pour l'utilisateur $USERNAME."
    quota -u $USERNAME
else
    echo "Une erreur s'est produite lors de la configuration du quota."
fi
